<!-- bpr.page.html -->
<ion-content>
  <header class="mainHeader">
    <div class="back-buttons">
      <button class="goback" (click)="goBack()">&#8249;</button>
    </div>
    <div class="logo-container">
      <img class="logoimg" src="assets/images/blogo.png" width="50" height="50" />
    </div>
    <div class="placeholderHeader"></div>
  </header>

  <div class="results-container" *ngIf="resultsTrue">
    <!-- Segmented Control -->
    <div class="segmented-control">
      <button
        class="segment"
        [class.active]="selectedSegment === 'chart'"
        (click)="selectSegment('chart')">
        <div    *ngIf="!isPortuguese" >Bar Charts</div>
        <div   *ngIf="isPortuguese" >Gráfico de barras</div>
      </button>

      <button
        class="segment"
        [class.active]="selectedSegment === 'calendar'"
        (click)="selectSegment('calendar')">
        <div    *ngIf="!isPortuguese" >Calendar</div>
        <div   *ngIf="isPortuguese" >Calendário</div>
      </button>
    </div>

    <!-- Segment Content -->
    <div class="segment-content">
      <div *ngIf="selectedSegment === 'chart'">
        <div class="calendar">
          <div class="chart-container">
            <canvas #allChartCanvas></canvas>
          </div>
        </div>
        <div class="calendarText"   *ngIf="!isPortuguese" >
          * Click on the bar to see results of that day
        </div>
        <div class="calendarText"   *ngIf="isPortuguese" >
          * Clique na barra para ver resultados do dia
        </div>
        <h4  *ngIf="!isPortuguese" class="chartText">Other charts</h4>
        <h4  *ngIf="isPortuguese" class="chartText">Outros gráficos</h4>
        <div id="resultsList" #resultsList></div>
      </div>
      <div *ngIf="selectedSegment === 'calendar'">
        <div class="calendar-header">
          <button (click)="changeMonth(-1)">&larr;</button>
          <span>{{ currentMonthName }} {{ currentYear }}</span>
          <button (click)="changeMonth(1)">&rarr;</button>
        </div>

        <div class="calendar-weekdays">
          <div *ngFor="let day of weekdays">{{ day }}</div>
        </div>

        <div class="calendar-grid">
          <div *ngFor="let blank of blankDays" class="calendar-day empty"></div>
          <div
            *ngFor="let day of daysInMonth"
            [class.current-day]="isToday(day)"
            [class.clickable]="hasResultsOnDay(day)"
            class="calendar-day"
            (click)="hasResultsOnDay(day) ? openResultsModal(day) : null">
            <span>{{ day }}</span>
            <div *ngIf="hasResultsOnDay(day)" class="dot"></div>
          </div>
        </div>

        <div class="calendarText"   *ngIf="!isPortuguese" >
          * Click on the days with dot to see results of that day
        </div>
        <div class="calendarText"   *ngIf="isPortuguese" >
          * Clique nos dias com um ponto para ver resultados do dia
        </div>
        <!-- Overview -->
        <div class="overview-box allexercises">
          <div class="overview-item">
            <strong    *ngIf="!isPortuguese" >Longest day of practice</strong>
            <strong  *ngIf="isPortuguese" >Maior tempo de prática em um dia</strong>
            <span    *ngIf="!isPortuguese" >{{ maxTotalMinutes }} on {{ maxTotalMinutesDate }}</span>
            <span  *ngIf="isPortuguese" >{{ maxTotalMinutes }} no dia {{ maxTotalMinutesDate }}</span>
          </div>
          <div class="overview-item">
            <strong    *ngIf="!isPortuguese" >Total time practiced</strong>
            <strong  *ngIf="isPortuguese" >Tempo total praticado</strong>
            <span>{{ totalPracticeFormatted }}</span>
          </div>
          <div class="overview-item">
            <strong    *ngIf="!isPortuguese" >Sessions</strong>
            <strong  *ngIf="isPortuguese" >Sessões</strong>
            <span>{{ totalSessions }}</span>
          </div>

          <!-- ✅ Longest streak ever (excluding BRT) -->
          <div class="overview-item">
            <strong    *ngIf="!isPortuguese" >Longest streak</strong>
            <strong  *ngIf="isPortuguese" >Maior sequência</strong>
            <span    *ngIf="!isPortuguese" >{{ longestStreakEver }} days</span>
            <span  *ngIf="isPortuguese" >{{ longestStreakEver }} dias</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="results-container" *ngIf="!resultsTrue">
    <div id="noResultsMessage">
      <div class="programpageStyle">
        <h2 class="justifyContent widthadjust"  *ngIf="!isPortuguese">Find out what your retention test score is to get started</h2>
        <h2 class="justifyContent widthadjust"  *ngIf="isPortuguese">Descubra qual é a sua pontuação no teste de retenção para começar</h2>

        <a class="breath-button widthadjust" routerLink="/brt">
          <img src="assets/images/brizaretention.png" alt="icon" class="iconBP" />
          <div class="textBP">
            <div class="titleBP"   *ngIf="!isPortuguese">Briza<br />Retention Test</div>
            <div class="subtitleBP"   *ngIf="!isPortuguese" >Measure your fitness level</div>

            <div class="titleBP"   *ngIf="isPortuguese" >Teste<br />de Retenção Briza</div>
            <div class="subtitleBP"   *ngIf="isPortuguese" >Medindo seu condicionamento</div>
          </div>
        </a>
      </div>
    </div>
  </div>
  <footer id="resultsFooter"    *ngIf="!isPortuguese" >
    <div class="navbar">
      <a class="navIcons" routerLink="/breathwork"><i class="fa fa-home"></i>Home</a>
      <a class="navIcons" routerLink="/home"><i class="fa fa-fire"></i>Breathwork</a>
      <a class="navIcons" routerLink="/yoga"><i class="fa fa-sun-o"></i>Yoga</a>
      <a class="active"><i class="fa fa-line-chart active"></i>Results</a>
      <a class="navIcons" routerLink="/profile"><i class="fa fa-user"></i>Profile</a>
    </div>
  </footer>

  <footer id="resultsFooterBR"  *ngIf="isPortuguese" >
    <div class="navbar">
      <a class="navIcons" routerLink="/breathwork"><i class="fa fa-home"></i>Home</a>
      <a class="navIcons" routerLink="/home"><i class="fa fa-fire"></i>Breathwork</a>
      <a class="navIcons" routerLink="/yoga"><i class="fa fa-sun-o"></i>Yoga</a>
      <a class="active"><i class="fa fa-line-chart active"></i>Resultados</a>
      <a class="navIcons" routerLink="/profile"><i class="fa fa-user"></i>Perfil</a>
    </div>
  </footer>

  <ion-modal [isOpen]="isModalOpen2" [backdropDismiss]="true" (didDismiss)="closeModal()">
    <div class="modal-content2">
      <div *ngIf="selectedDateResults.length; else noResults">
        <div class="modal-header">
          <div></div>
          <h2>{{ selectedDateHeader }}</h2>
          <button type="button" (click)="onCloseModalClick($event)" class="close-button">X</button>
        </div>

        <div *ngFor="let result of selectedDateResults" class="result-item">
          <h3>{{ getExerciseName(result.exerciseKey) }}</h3>

          <div *ngIf="isMultiRoundExercise(result.exerciseKey)">
            <div *ngFor="let round of result.roundsResult; let i = index">
              <p>Round {{ i + 1 }}: {{ formatTime(round) }}</p>
            </div>
          </div>

          <div *ngIf="!isMultiRoundExercise(result.exerciseKey)">
            <p *ngIf="result.result">Result: {{ result.result }}</p>
            <p *ngIf="result.rounds">Rounds: {{ result.rounds }}</p>
          </div>

          <button (click)="confirmDelete(result)" class="delete-button"><img class="logoimg" src="assets/images/trash.png" width="25" height="25" /></button>
        </div>
      </div>

      <ng-template #noResults>
        <p  *ngIf="!isPortuguese">No results available for this date.</p>
        <p  *ngIf="isPortuguese">Nenhum resultado disponível para esta data.</p>
      </ng-template>
    </div>
  </ion-modal>
</ion-content>
